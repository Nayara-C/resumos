<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Resumos Acad√©micos - 11¬∫ A (Groq)</title>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 250px;
        }

        .info-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            padding: 5px 0;
            color: #555;
        }

        .info-box li::before {
            content: "‚Üí ";
            color: #667eea;
            font-weight: bold;
        }

        .info-box small {
            display: block;
            margin-top: 5px;
            color: #666;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #667eea;
            font-size: 1.1em;
            font-weight: 600;
        }

        .result {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }

        .result.active {
            display: block;
        }

        .result h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .result-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #555;
        }

        .result-info strong {
            color: #2e7d32;
        }

        .result-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .result-buttons .btn {
            margin-top: 0;
        }

        .btn-download {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
        }

        .btn-email {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .error {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #ffebee;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            color: #c62828;
        }

        .error.active {
            display: block;
        }

        .warning {
            display: none;
            margin-top: 20px;
            padding: 25px;
            background: #fff3e0;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
            color: #e65100;
        }

        .warning.active {
            display: block;
        }

        .warning h3 {
            margin-bottom: 15px;
            color: #ff9800;
        }

        .warning ul {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .warning li {
            padding: 5px 0;
            color: #666;
        }

        .warning li::before {
            content: "‚Ä¢ ";
            color: #ff9800;
            font-weight: bold;
            margin-right: 5px;
        }

        .char-count {
            text-align: right;
            font-size: 0.9em;
            color: #777;
            margin-top: 5px;
        }

        .auto-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            color: #1565c0;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 25px;
            }

            .result-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Gerador de Resumos - 11¬∫ A</h1>
            <p>Escola Secund√°ria Augusto Cabrita</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h3>üìå Disciplinas e Professores</h3>
                <ul>
                    <li>Biologia e Geologia ‚Üí M√°rcio Miguel Monteiro</li>
                    <li>Educa√ß√£o F√≠sica ‚Üí Nuno Correia</li>
                    <li>Filosofia ‚Üí Francisco Ferreira</li>
                    <li>F√≠sica e Qu√≠mica A ‚Üí Dulce Bandeira</li>
                    <li>Ingl√™s I ‚Üí Clara Soares</li>
                    <li>Matem√°tica A ‚Üí Jos√© Correia</li>
                    <li>Portugu√™s ‚Üí Maria do C√©u Gon√ßalves</li>
                </ul>
            </div>

            <form id="resumoForm">
                <div class="form-group">
                    <label for="data">üìÖ Data das Aulas *</label>
                    <input type="date" id="data" required>
                    <div class="auto-info" id="diaInfo">
                        ‚ÑπÔ∏è Seleciona a data - o bloco e sala ser√£o determinados automaticamente
                    </div>
                </div>

                <div class="form-group">
                    <label for="prompt">‚úçÔ∏è Descri√ß√£o das Aulas do Dia *</label>
                    <div class="info-box" style="margin-bottom: 10px; background: #fff3e0; border-left-color: #ff9800;">
                        <h3 style="color: #ff9800;">üí° Dicas para escrever mais (atingir 200 palavras):</h3>
                        <ul style="font-size: 0.9em; color: #666;">
                            <li><strong>O que fizeram?</strong> Exerc√≠cios, leitura, v√≠deos, experi√™ncias, debate, apresenta√ß√µes...</li>
                            <li><strong>Que mat√©ria/t√≥picos?</strong> Nomes espec√≠ficos (leis, teorias, obras, conceitos)</li>
                            <li><strong>Exemplos dados?</strong> Casos pr√°ticos, situa√ß√µes reais mencionadas</li>
                            <li><strong>Quantos exerc√≠cios?</strong> "Fizemos 10 exerc√≠cios", "Resolvemos 3 problemas"</li>
                            <li><strong>Como foi feito?</strong> Individual, grupo, quadro, manual, computador...</li>
                            <li><strong>Etapas da aula?</strong> "Come√ß√°mos por...", "Depois...", "No final..."</li>
                        </ul>
                        <p style="margin-top: 10px; font-size: 0.85em; color: #e65100;">
                            <strong>‚ö†Ô∏è Dias curtos (autoavalia√ß√£o, teste, etc):</strong> Descreve o processo, crit√©rios usados, quanto tempo demorou, como foi organizado.
                        </p>
                    </div>
                    <textarea 
                        id="prompt" 
                        placeholder="Exemplo detalhado:

Na aula de Matem√°tica fizemos autoavalia√ß√£o onde cada aluno avaliou o seu desempenho no per√≠odo. Us√°mos uma grelha com crit√©rios como participa√ß√£o, trabalhos entregues, resultados dos testes e empenho. Eu avaliei-me em cada crit√©rio de 1 a 5 e justifiquei. Depois compar√°mos com a avalia√ß√£o da professora e discutimos as diferen√ßas. No final preenchemos um plano de melhoria para o pr√≥ximo per√≠odo.

Na aula de F√≠sica estud√°mos as leis de Newton. Come√ß√°mos pela primeira lei (in√©rcia) com exemplos do dia a dia como travagens de carro. Depois vimos a segunda lei (F=ma) e fizemos 8 exerc√≠cios de c√°lculo de for√ßas. A professora mostrou um v√≠deo sobre colis√µes e explicou a terceira lei (a√ß√£o-rea√ß√£o). No laborat√≥rio fizemos uma experi√™ncia com carrinhos para medir acelera√ß√µes.

Na aula de Portugu√™s analis√°mos Os Maias. Lemos o cap√≠tulo sobre o jantar no Hotel Central e identific√°mos a cr√≠tica social de E√ßa. Discutimos as caracter√≠sticas do Realismo como objetividade e cr√≠tica de costumes. Fizemos um esquema das personagens principais e as suas rela√ß√µes. A professora pediu um trabalho sobre a Lisboa oitocentista para a pr√≥xima aula."
                        required
                        minlength="100"></textarea>
                    <div class="char-count" id="charCount">0 caracteres</div>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    üöÄ Gerar Resumos Acad√©micos
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div class="loading-text">A gerar os teus resumos acad√©micos...</div>
                <p style="color: #777; margin-top: 10px;">Isto pode demorar alguns momentos</p>
            </div>

            <div class="error" id="error"></div>

            <div class="warning" id="warning">
                <h3>‚ö†Ô∏è Alguns resumos t√™m menos de 200 palavras</h3>
                <div id="warningContent"></div>
                <p style="margin-top: 15px;">O que queres fazer?</p>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn" id="continuarBtn" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
                        ‚úì Continuar Mesmo Assim
                    </button>
                    <button class="btn" id="gerarNovamenteBtn" style="background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%);">
                        üîÑ Gerar Novamente
                    </button>
                </div>
            </div>

            <div class="result" id="result">
                <h3>‚úÖ Resumos Gerados com Sucesso!</h3>
                <div class="result-info" id="resultInfo"></div>
                <p>O teu documento Word est√° pronto com todos os resumos acad√©micos.</p>
                <div class="result-buttons">
                    <button class="btn btn-download" id="downloadBtn">
                        üíæ Descarregar Documento
                    </button>
                    <button class="btn btn-email" id="emailBtn">
                        üìß Enviar Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURA√á√ÉO DO UTILIZADOR =====
        // Email do destinat√°rio (email do teu pai)
        const EMAIL_DESTINO = "paulo.deborja@gmail.com";
        const NOME_UTILIZADOR = "Nayara Cassam√°"; // Para assinatura do email
        // ======================================

        // HOR√ÅRIO 11¬∫ A - Escola Augusto Cabrita
        const HORARIO = {
            // Segunda (1)
            1: {
                'Matem√°tica A': { bloco: 'A', sala: 'A.B08' },
                'Filosofia': { bloco: 'B', sala: 'A.B08' },
                'Espanhol III': { bloco: 'C', sala: 'A.CS02' },
                'Ingl√™s I': { bloco: 'C', sala: 'A.B08' },
                'F√≠sica e Qu√≠mica A': { bloco: 'D', sala: 'A.F06' }
            },
            // Ter√ßa (2)
            2: {
                'Matem√°tica A': { bloco: 'A', sala: 'A.B08' },
                'Portugu√™s': { bloco: 'A', sala: 'A.B08' },
                'Biologia e Geologia': { bloco: 'B', sala: 'A.D02' },
                'F√≠sica e Qu√≠mica A': { bloco: 'B', sala: 'A.F02' }
            },
            // Quarta (3)
            3: {
                'Matem√°tica A': { bloco: 'A', sala: 'A.B08' },
                'Filosofia': { bloco: 'B', sala: 'A.C04' },
                'Educa√ß√£o F√≠sica': { bloco: 'B', sala: 'A.PAV-2' },
                'Biologia e Geologia': { bloco: 'D', sala: 'A.D08' }
            },
            // Quinta (4)
            4: {
                'Espanhol III': { bloco: 'A', sala: 'A.F10' },
                'Ingl√™s I': { bloco: 'A', sala: 'A.B08' },
                'Portugu√™s': { bloco: 'B', sala: 'A.B08' },
                'F√≠sica e Qu√≠mica A': { bloco: 'D', sala: 'A.F06' }
            },
            // Sexta (5)
            5: {
                'Biologia e Geologia': { bloco: 'A', sala: 'A.D08' },
                'Educa√ß√£o F√≠sica': { bloco: 'B', sala: 'A.PAV-2' },
                'Portugu√™s': { bloco: 'B', sala: 'A.D06' },
                'Filosofia': { bloco: 'C', sala: 'A.D06' }
            }
        };

        // Configura√ß√£o das disciplinas e professores
        const DISCIPLINAS = {
            'biologia e geologia': 'M√°rcio Miguel Monteiro',
            'biologia': 'M√°rcio Miguel Monteiro',
            'geologia': 'M√°rcio Miguel Monteiro',
            'bio-geo': 'M√°rcio Miguel Monteiro',
            'educa√ß√£o f√≠sica': 'Nuno Correia',
            'educacao fisica': 'Nuno Correia',
            'ed. f√≠sica': 'Nuno Correia',
            'edf': 'Nuno Correia',
            'filosofia': 'Francisco Ferreira',
            'f√≠sica e qu√≠mica a': 'Dulce Bandeira',
            'fisica e quimica a': 'Dulce Bandeira',
            'f√≠sica e qu√≠mica': 'Dulce Bandeira',
            'f√≠sica': 'Dulce Bandeira',
            'fq-a': 'Dulce Bandeira',
            'fisico-quimica': 'Dulce Bandeira',
            'qu√≠mica': 'Dulce Bandeira',
            'quimica': 'Dulce Bandeira',
            'ingl√™s i': 'Clara Soares',
            'ingles i': 'Clara Soares',
            'ingl√™s': 'Clara Soares',
            'ingles': 'Clara Soares',
            'matem√°tica a': 'Jos√© Correia',
            'matematica a': 'Jos√© Correia',
            'matem√°tica': 'Jos√© Correia',
            'matematica': 'Jos√© Correia',
            'mat-a': 'Jos√© Correia',
            'portugu√™s': 'Maria do C√©u Gon√ßalves',
            'portugues': 'Maria do C√©u Gon√ßalves',
            'port': 'Maria do C√©u Gon√ßalves'
        };

        let generatedDocument = null;
        let currentResumos = null; // Armazena resumos atuais
        let currentData = null; // Armazena data atual
        let currentDiaSemana = null; // Armazena dia da semana atual

        // Contador de caracteres
        const promptTextarea = document.getElementById('prompt');
        const charCount = document.getElementById('charCount');

        promptTextarea.addEventListener('input', () => {
            charCount.textContent = `${promptTextarea.value.length} caracteres`;
        });

        // Definir data de hoje por defeito
        document.getElementById('data').valueAsDate = new Date();

        // Atualizar info do dia ao selecionar data
        document.getElementById('data').addEventListener('change', (e) => {
            const data = new Date(e.target.value + 'T00:00:00');
            const diaSemana = data.getDay();
            const nomesDias = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            
            const diaInfo = document.getElementById('diaInfo');
            
            if (diaSemana === 0 || diaSemana === 6) {
                diaInfo.innerHTML = '‚ö†Ô∏è Fim de semana selecionado - n√£o h√° aulas';
                diaInfo.style.background = '#fff3e0';
                diaInfo.style.borderLeftColor = '#ff9800';
            } else {
                diaInfo.innerHTML = `üìÖ ${nomesDias[diaSemana]} - Bloco e sala ser√£o determinados automaticamente por disciplina`;
                diaInfo.style.background = '#e3f2fd';
                diaInfo.style.borderLeftColor = '#2196f3';
            }
        });

        // Submit do formul√°rio
        document.getElementById('resumoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = document.getElementById('data').value;
            const prompt = document.getElementById('prompt').value;

            // Obter dia da semana
            const dataObj = new Date(data + 'T00:00:00');
            const diaSemana = dataObj.getDay();

            if (diaSemana === 0 || diaSemana === 6) {
                alert('‚ö†Ô∏è N√£o h√° aulas ao fim de semana!');
                return;
            }

            // Guardar dados atuais
            currentData = data;
            currentDiaSemana = diaSemana;

            // Mostrar loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('error').classList.remove('active');
            document.getElementById('warning').classList.remove('active');
            document.getElementById('result').classList.remove('active');
            document.getElementById('submitBtn').disabled = true;

            try {
                // Gerar resumos com IA
                const resultado = await gerarResumos(prompt);
                currentResumos = resultado.disciplinas;
                
                // Verificar se h√° avisos
                if (resultado.avisos && resultado.avisos.length > 0) {
                    // Mostrar aviso com op√ß√£o de continuar
                    mostrarAviso(resultado.avisos);
                } else {
                    // Tudo OK, criar documento
                    await finalizarDocumento();
                }

            } catch (error) {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('error').textContent = `‚ùå Erro: ${error.message}`;
                document.getElementById('error').classList.add('active');
                document.getElementById('submitBtn').disabled = false;
            }
        });

        // Fun√ß√£o para mostrar aviso
        function mostrarAviso(avisos) {
            document.getElementById('loading').classList.remove('active');
            
            let conteudo = '<ul>';
            avisos.forEach(aviso => {
                conteudo += `<li><strong>${aviso.disciplina}:</strong> ${aviso.palavras} palavras (faltam ${200 - aviso.palavras})</li>`;
            });
            conteudo += '</ul>';
            
            document.getElementById('warningContent').innerHTML = conteudo;
            document.getElementById('warning').classList.add('active');
            document.getElementById('submitBtn').disabled = false;
        }

        // Bot√£o "Continuar Mesmo Assim"
        document.getElementById('continuarBtn').addEventListener('click', async () => {
            document.getElementById('warning').classList.remove('active');
            document.getElementById('loading').classList.add('active');
            document.getElementById('loading').querySelector('.loading-text').textContent = 'A criar documento...';
            
            try {
                await finalizarDocumento();
            } catch (error) {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('error').textContent = `‚ùå Erro: ${error.message}`;
                document.getElementById('error').classList.add('active');
            }
        });

        // Bot√£o "Gerar Novamente"
        document.getElementById('gerarNovamenteBtn').addEventListener('click', () => {
            document.getElementById('warning').classList.remove('active');
            document.getElementById('resumoForm').dispatchEvent(new Event('submit'));
        });

        // Fun√ß√£o para finalizar e mostrar resultado
        async function finalizarDocumento() {
            // Criar documento Word
            await criarDocumentoWord(currentResumos, currentData, currentDiaSemana);
            
            // Mostrar informa√ß√µes do resultado
            const nomesDias = ['', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira'];
            const resultInfo = document.getElementById('resultInfo');
            
            // Contar palavras totais
            const totalPalavras = currentResumos.reduce((total, disc) => {
                return total + disc.resumo.split(/\s+/).filter(p => p.length > 0).length;
            }, 0);
            
            resultInfo.innerHTML = `
                <strong>üìÖ Data:</strong> ${formatarData(currentData)} (${nomesDias[currentDiaSemana]})<br>
                <strong>üìö Disciplinas:</strong> ${currentResumos.length}<br>
                <strong>üìù Total palavras:</strong> ${totalPalavras} palavras (m√≠nimo 200 por disciplina)
            `;
            
            // Mostrar resultado
            document.getElementById('loading').classList.remove('active');
            document.getElementById('result').classList.add('active');
            document.getElementById('submitBtn').disabled = false;
            
            // Restaurar texto do loading
            document.getElementById('loading').querySelector('.loading-text').textContent = 'A gerar os teus resumos acad√©micos...';
        }

        // Bot√£o de download
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (generatedDocument) {
                const blob = new Blob([generatedDocument], { 
                    type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
                });
                const data = document.getElementById('data').value;
                const fileName = `${formatarNomeFicheiro(data)}.docx`;
                saveAs(blob, fileName);
            }
        });

        // Bot√£o de enviar email
        document.getElementById('emailBtn').addEventListener('click', () => {
            if (!generatedDocument) {
                alert('‚ùå Erro: Documento n√£o gerado!');
                return;
            }

            if (EMAIL_DESTINO === "email.do.pai@exemplo.com") {
                alert('‚ö†Ô∏è Email de destino n√£o configurado!\n\nEdita EMAIL_DESTINO no c√≥digo com o email do teu pai.');
                return;
            }

            // Preparar dados do email
            const data = document.getElementById('data').value;
            const dataFormatada = formatarData(data);
            
            const assunto = `Resumo do dia ${dataFormatada}`;
            const corpo = `Boa tarde, pap√°

Venho por este meio enviar o resumo do dia ${dataFormatada}, passo a expor.

O documento encontra-se em anexo.

Com os melhores cumprimentos,
${NOME_UTILIZADOR}`;

            // Codificar para URL
            const mailtoLink = `mailto:${EMAIL_DESTINO}?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
            
            // Abrir cliente de email
            window.location.href = mailtoLink;
            
            // Instru√ß√µes para o utilizador
            setTimeout(() => {
                alert('üìß Email preparado!\n\n1. O teu cliente de email vai abrir\n2. ANEXA o documento Word que descarregaste\n3. Clica "Enviar"\n\n‚úÖ Pronto!');
            }, 500);
        });

        async function gerarResumos(prompt) {
            const apiKey = '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';

            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'llama-3.3-70b-versatile',
                    messages: [{
                        role: 'user',
                        content: `ATEN√á√ÉO CR√çTICA: 
1. Cada resumo DEVE ter NO M√çNIMO 200 PALAVRAS (OBRIGAT√ìRIO)
2. Escreve em PORTUGU√äS EUROPEU (de Portugal) - NUNCA uses portugu√™s brasileiro!
3. Na aula de Ingl√™s I podes usar ingl√™s para termos da mat√©ria
4. USA O G√âNERO CORRETO quando falares dos professores (ver lista abaixo)

EXEMPLOS PORTUGU√äS EUROPEU:
‚úÖ experi√™ncia (n√£o "experimento")
‚úÖ autocarro (n√£o "√¥nibus") 
‚úÖ telem√≥vel (n√£o "celular")

√âs um assistente que ajuda a criar resumos de aulas escolares com tom natural de aluno real portugu√™s.

REGRAS ABSOLUTAS:

TAMANHO DO RESUMO:
- M√çNIMO ABSOLUTO: 200 PALAVRAS por disciplina
- Se est√°s abaixo de 200 palavras, PARA e ADICIONA MAIS CONTE√öDO
- **ESTRAT√âGIAS OBRIGAT√ìRIAS PARA ATINGIR 200 PALAVRAS:**
  
  1. **EXPLICA OS CONCEITOS EM PROFUNDIDADE:**
     - N√£o digas s√≥ "estud√°mos X", explica o que √© X em 2-3 frases
     - D√° a defini√ß√£o completa
     - Explica como funciona passo a passo
     
  2. **ADICIONA DETALHES DOS EXERC√çCIOS:**
     - N√£o digas s√≥ "fizemos exerc√≠cios"
     - Diz quantos exerc√≠cios (n√∫mero aproximado)
     - D√° exemplos concretos de 1-2 exerc√≠cios
     - Descreve que tipo de c√°lculos ou processos
     
  3. **EXPLICA O PORQU√ä E PARA QU√ä:**
     - Porque √© que este conceito √© importante
     - Onde se aplica na pr√°tica
     - Para que serve no dia a dia ou noutras mat√©rias
     
  4. **DESCREVE O PROCESSO DA AULA:**
     - Como come√ßou (revis√£o, introdu√ß√£o nova mat√©ria)
     - O que fizeram a meio (explica√ß√£o, pr√°tica)
     - Como terminou (trabalhos, resumo)
     
  5. **RELACIONA COM OUTROS CONCEITOS:**
     - Liga com mat√©ria anterior
     - Menciona pr√©-requisitos
     - Fala de aplica√ß√µes futuras

- **NUNCA** entregues um resumo curto - EXPANDE sempre at√© atingir o m√≠nimo
- Se chegas a 180-190 palavras, continua a adicionar mais 1-2 frases de contexto ou exemplos

IN√çCIO DO TEXTO:
- Come√ßa SEMPRE com: "Hoje na aula de [disciplina]..."
- N√ÉO uses exatamente as palavras do aluno, adapta para este formato
- Exemplo: Se o aluno diz "estud√°mos derivadas", escreve "Hoje na aula de Matem√°tica A estud√°mos derivadas..."

PROFESSORES E G√âNERO CORRETO:
Quando mencionares professores, USA O G√âNERO CORRETO:
- Biologia e Geologia ‚Üí M√°rcio Miguel Monteiro (MASCULINO) ‚Üí "o professor"
- Educa√ß√£o F√≠sica ‚Üí Nuno Correia (MASCULINO) ‚Üí "o professor"
- Filosofia ‚Üí Francisco Ferreira (MASCULINO) ‚Üí "o professor"
- F√≠sica e Qu√≠mica A ‚Üí Dulce Bandeira (FEMININO) ‚Üí "a professora"
- Ingl√™s I ‚Üí Clara Soares (FEMININO) ‚Üí "a professora"
- Matem√°tica A ‚Üí Jos√© Correia (MASCULINO) ‚Üí "o professor"
- Portugu√™s ‚Üí Maria do C√©u Gon√ßalves (FEMININO) ‚Üí "a professora"

IMPORTANTE: Verifica sempre o g√©nero antes de escrever "o professor" ou "a professora"!

IDIOMA E L√çNGUA:
- Escreve EXCLUSIVAMENTE em **PORTUGU√äS EUROPEU (de Portugal)**
- **NUNCA uses PORTUGU√äS BRASILEIRO** - √© muito importante!
- **EXCEP√á√ÉO: Na disciplina de Ingl√™s I, podes usar palavras/express√µes em ingl√™s quando forem parte da mat√©ria (ex: "Present Perfect", "have/has + past participle", vocabul√°rio ensinado)**
- Para TODAS as outras disciplinas: NUNCA uses palavras em ingl√™s

PORTUGU√äS EUROPEU vs BRASILEIRO (CR√çTICO):

‚ùå NUNCA USES (Brasileiro):
‚Ä¢ experimento ‚Üí ‚úÖ experi√™ncia
‚Ä¢ trem ‚Üí ‚úÖ comboio
‚Ä¢ √¥nibus ‚Üí ‚úÖ autocarro
‚Ä¢ celular ‚Üí ‚úÖ telem√≥vel
‚Ä¢ time (equipe) ‚Üí ‚úÖ equipa
‚Ä¢ tela ‚Üí ‚úÖ ecr√£
‚Ä¢ mouse ‚Üí ‚úÖ rato
‚Ä¢ deletar ‚Üí ‚úÖ apagar/eliminar
‚Ä¢ salvar ‚Üí ‚úÖ guardar
‚Ä¢ arquivo ‚Üí ‚úÖ ficheiro
‚Ä¢ pasta ‚Üí ‚úÖ pasta (OK - esta √© igual)
‚Ä¢ legal (no sentido de "fixe") ‚Üí ‚úÖ fixe/giro
‚Ä¢ bacana ‚Üí ‚úÖ fixe/giro/porreiro

CONTEXTO ESCOLAR ESPEC√çFICO:
‚Ä¢ mat√©ria (no sentido de conte√∫do) ‚Üí ‚úÖ mat√©ria (OK em contexto escolar)
‚Ä¢ prova ‚Üí ‚úÖ teste/exame
‚Ä¢ nota ‚Üí ‚úÖ nota (OK)
‚Ä¢ col√©gio ‚Üí ‚úÖ escola/col√©gio (ambos OK)

‚úÖ SEMPRE USA VOCABUL√ÅRIO DE PORTUGAL

Se tiveres d√∫vida sobre uma palavra, usa a vers√£o mais formal e europeia.

TOM E ESTILO:
- Linguagem simples, natural, informal (mas n√£o infantil)
- Frases curtas a m√©dias
- Tom normal de aluno a descrever o que fez
- **PURA DESCRI√á√ÉO factual** do que aconteceu na aula
- **SEM AVALIA√á√ÉO** - n√£o digas se foi bom, mau, √∫til, interessante, dif√≠cil, f√°cil
- Sem palavras t√©cnicas exageradas
- Sem frases demasiado perfeitas ou elaboradas

DESCRI√á√ÉO vs AVALIA√á√ÉO (CR√çTICO):
‚ùå AVALIA√á√ÉO: "A aula foi muito √∫til"
‚úÖ DESCRI√á√ÉO: "Na aula estud√°mos X e fizemos Y"

‚ùå AVALIA√á√ÉO: "Foi estimulante aprender sobre..."
‚úÖ DESCRI√á√ÉO: "Aprendemos sobre... e vimos exemplos de..."

‚ùå AVALIA√á√ÉO: "Esta mat√©ria √© importante"
‚úÖ DESCRI√á√ÉO: "Esta mat√©ria serve para calcular..."

‚ùå AVALIA√á√ÉO: "Foi interessante descobrir que..."
‚úÖ DESCRI√á√ÉO: "Vimos que..."

‚ùå AVALIA√á√ÉO: "Ajudou-me a compreender melhor"
‚úÖ DESCRI√á√ÉO: "Fizemos exerc√≠cios sobre..."

REGRA DE OURO: Se est√°s a dar opini√£o sobre a aula, PARA e reescreve s√≥ com factos!

O QUE NUNCA FAZER:
‚ùå Portugu√™s brasileiro ("experimento", "trem", "√¥nibus", "celular") - S√ì portugu√™s europeu!
‚ùå Palavras em ingl√™s nas outras disciplinas (exceto na aula de Ingl√™s I onde √© normal!)
‚ùå G√©nero errado dos professores (verifica a lista acima!)
‚ùå Opini√µes sobre dificuldade ("foi f√°cil", "foi dif√≠cil", "foi complicado")
‚ùå Avalia√ß√µes da aula ("foi √∫til", "foi estimulante", "foi proveitoso", "foi enriquecedor")
‚ùå Avalia√ß√µes do professor ("explicou bem", "explicou mal", "foi claro")
‚ùå Aprecia√ß√µes cr√≠ticas de qualquer tipo
‚ùå Frases t√≠picas de IA:
   ‚Ä¢ "foi muito interessante"
   ‚Ä¢ "foi produtivo"
   ‚Ä¢ "contribuiu para"
   ‚Ä¢ "a aula foi √∫til"
   ‚Ä¢ "foi estimulante"
   ‚Ä¢ "foi importante"
   ‚Ä¢ "ajudou a compreender"
   ‚Ä¢ "permitiu desenvolver"
   ‚Ä¢ "foi essencial"
‚ùå Conclus√µes separadas tipo "no final percebi que...", "aprendi que...", "compreendi a import√¢ncia..."
‚ùå Tom demasiado formal ou acad√©mico
‚ùå Tom demasiado infantil ou com erros propositados

LEMBRA-TE: √âs um aluno a DESCREVER o que fizeste, N√ÉO a AVALIAR se foi bom/mau/√∫til/interessante!

O QUE FAZER:
‚úÖ Descrever factualmente o que foi feito na aula
‚úÖ Explicar o que s√£o os conceitos (dentro da descri√ß√£o natural)
‚úÖ Listar exerc√≠cios/atividades feitas
‚úÖ Mencionar exemplos dados
‚úÖ Integrar a "conclus√£o" naturalmente na explica√ß√£o (n√£o como sec√ß√£o separada)
‚úÖ **QUANDO FALTAR CONTE√öDO: EXPANDE AS EXPLICA√á√ïES**
  - Em vez de s√≥ dizer "estud√°mos X", explica o que √© X em detalhe
  - D√° exemplos pr√°ticos de onde se aplica
  - Explica como funciona ou como se calcula
  - Relaciona com coisas do dia a dia
  - Menciona a import√¢ncia ou utilidade
  - Descreve os passos de um processo

EXEMPLO DE EXPANS√ÉO:
‚ùå CURTO: "Estud√°mos a f√≥rmula resolvente"
‚úÖ EXPANDIDO: "Estud√°mos a f√≥rmula resolvente, que √© x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a e permite encontrar as ra√≠zes de qualquer equa√ß√£o do segundo grau. Esta f√≥rmula funciona porque deriva do processo de completar o quadrado aplicado √† forma geral ax¬≤ + bx + c = 0. O discriminante (b¬≤ - 4ac) √© a parte mais importante porque indica quantas solu√ß√µes existem: se for positivo h√° duas solu√ß√µes reais diferentes, se for zero h√° uma solu√ß√£o dupla, e se for negativo n√£o h√° solu√ß√µes reais mas sim complexas"

EXEMPLO DE COMO ATINGIR 200 PALAVRAS:

**VERS√ÉO CURTA (150 palavras - INSUFICIENTE ‚ùå):**
"Hoje na aula de Matem√°tica A estud√°mos equa√ß√µes do segundo grau. Vimos a f√≥rmula resolvente e aprendemos sobre o discriminante. Fizemos exerc√≠cios de aplica√ß√£o da f√≥rmula. Alguns exerc√≠cios eram mais f√°ceis e outros mais dif√≠ceis. No final tivemos trabalho de casa."

**COMO EXPANDIR PARA 200+ PALAVRAS (‚úÖ):**
ADICIONA:
- Explica√ß√£o detalhada da f√≥rmula (o que √©, como funciona)
- Defini√ß√£o completa do discriminante (o que indica, casos diferentes)
- QUANTOS exerc√≠cios fizeram (n√∫mero aproximado)
- EXEMPLOS concretos de 1-2 exerc√≠cios
- COMO era o processo (passo a passo)
- PARA QUE serve esta mat√©ria (aplica√ß√µes pr√°ticas)

**VERS√ÉO EXPANDIDA (210 palavras - CORRETO ‚úÖ):**
"Hoje na aula de Matem√°tica A estud√°mos equa√ß√µes do segundo grau, que s√£o equa√ß√µes na forma ax¬≤ + bx + c = 0 onde o coeficiente a n√£o pode ser zero. Trabalh√°mos a f√≥rmula resolvente x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a que permite encontrar as ra√≠zes de qualquer equa√ß√£o deste tipo. Esta f√≥rmula funciona porque deriva do m√©todo de completar o quadrado aplicado √† forma geral.

Aprendemos sobre o discriminante, que √© a parte b¬≤ - 4ac dentro da raiz quadrada. O professor explicou que o discriminante √© fundamental porque determina quantas solu√ß√µes reais existem: se for positivo h√° duas solu√ß√µes diferentes, se for zero h√° uma solu√ß√£o dupla, e se for negativo n√£o h√° solu√ß√µes reais no conjunto dos n√∫meros reais mas sim solu√ß√µes complexas.

Fizemos cerca de doze exerc√≠cios de aplica√ß√£o. Nos primeiros, as equa√ß√µes j√° estavam na forma padr√£o e s√≥ t√≠nhamos que substituir os valores na f√≥rmula. Por exemplo, num exerc√≠cio t√≠nhamos x¬≤ - 5x + 6 = 0 e calcul√°mos que as ra√≠zes eram 2 e 3. Depois fizemos exerc√≠cios mais complexos onde primeiro era preciso reorganizar a equa√ß√£o. No final o professor deixou cinco exerc√≠cios para trabalho de casa sobre problemas pr√°ticos como calcular dimens√µes de terrenos."

REPARA: Diz "o professor" porque Matem√°tica A √© Jos√© Correia (masculino). Se fosse Portugu√™s seria "a professora" (Maria do C√©u Gon√ßalves - feminino).

EXEMPLO DE INGL√äS I (com termos em ingl√™s - CORRETO):
"Hoje na aula de Ingl√™s I trabalh√°mos o Present Perfect. A professora explicou a estrutura have/has + past participle e quando usar este tempo verbal. Vimos que se usa para a√ß√µes que come√ßaram no passado e continuam no presente, como 'I have lived here for 5 years', e tamb√©m para experi√™ncias de vida sem mencionar quando, tipo 'I have been to Paris'. Fizemos exerc√≠cios onde t√≠nhamos que escolher entre Past Simple e Present Perfect. Um exemplo era 'I ___ (visit) London last year' que √© Past Simple porque tem 'last year'. Outro era 'She ___ (never/eat) sushi' que √© Present Perfect porque √© experi√™ncia sem tempo espec√≠fico. No final ouvimos um di√°logo onde duas pessoas falavam sobre viagens e tivemos que identificar todas as frases em Present Perfect."

REPARA: Usa termos em ingl√™s (Present Perfect, past participle, have/has) porque √© aula de INGL√äS e faz parte da mat√©ria!

ESTRUTURA DO TEXTO:
- Escreve em par√°grafos naturais (m√≠nimo 3 linhas cada)
- Separa par√°grafos com linha em branco (\\n\\n)
- Integra tudo de forma fluida - n√£o separes em "introdu√ß√£o, desenvolvimento, conclus√£o"
- A explica√ß√£o do que √© a mat√©ria deve fluir naturalmente com a descri√ß√£o

EXEMPLO DO TOM CORRETO (200+ palavras):
"Hoje na aula de Matem√°tica A trabalh√°mos equa√ß√µes do segundo grau e a aplica√ß√£o da f√≥rmula resolvente. Come√ß√°mos por relembrar a estrutura geral ax¬≤ + bx + c = 0 e as diferentes formas que estas equa√ß√µes podem ter. A professora explicou que o coeficiente a nunca pode ser zero, sen√£o deixa de ser uma equa√ß√£o do segundo grau e passa a ser do primeiro grau.

Depois avan√ß√°mos para a f√≥rmula resolvente, que √© x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a. Esta f√≥rmula permite encontrar as ra√≠zes de qualquer equa√ß√£o do segundo grau e funciona porque deriva do m√©todo de completar o quadrado aplicado √† forma geral. O discriminante, que √© a parte b¬≤ - 4ac dentro da raiz quadrada, √© fundamental porque determina quantas solu√ß√µes reais a equa√ß√£o tem. Se o discriminante for positivo, existem duas solu√ß√µes reais diferentes. Se for zero, existe apenas uma solu√ß√£o real (ou duas iguais). Se for negativo, n√£o h√° solu√ß√µes reais mas sim solu√ß√µes complexas. A professora explicou que isto acontece porque n√£o se pode tirar a raiz quadrada de um n√∫mero negativo no conjunto dos n√∫meros reais.

Fizemos cerca de quinze exerc√≠cios pr√°ticos do manual, come√ßando pelos mais simples onde as equa√ß√µes j√° vinham na forma padr√£o e s√≥ t√≠nhamos de aplicar a f√≥rmula diretamente. Depois fizemos equa√ß√µes que precisavam de ser reorganizadas primeiro, com termos dos dois lados da igualdade. Alguns exerc√≠cios pediam para calcular as ra√≠zes e depois fazer a verifica√ß√£o, substituindo os valores encontrados na equa√ß√£o original para confirmar que davam zero.

No final da aula trabalh√°mos problemas de aplica√ß√£o pr√°tica. Um exerc√≠cio pedia para calcular as dimens√µes de um ret√¢ngulo sabendo que a √°rea era 24 cm¬≤ e que o comprimento era o dobro da largura mais 2 cm. Outro problema envolvia calcular a altura m√°xima de um proj√©til lan√ßado verticalmente. A professora deixou mais exerc√≠cios para trabalho de casa."

NOTA IMPORTANTE: Repara como as explica√ß√µes est√£o expandidas naturalmente (o que √© o discriminante, como funciona, porqu√™, exemplos concretos de exerc√≠cios). Esta expans√£o √© essencial para atingir as 200 palavras mantendo o tom natural de aluno. SEMPRE que n√£o tiveres conte√∫do suficiente, EXPANDE as explica√ß√µes desta forma.

DISCIPLINAS V√ÅLIDAS:
- Biologia e Geologia
- Educa√ß√£o F√≠sica
- Filosofia
- F√≠sica e Qu√≠mica A
- Ingl√™s I
- Matem√°tica A
- Portugu√™s

‚ö†Ô∏è LEMBRETE CR√çTICO ANTES DE GERAR:
- Cada resumo DEVE ter 200+ palavras
- Escreve em PORTUGU√äS EUROPEU (n√£o brasileiro! "experi√™ncia" n√£o "experimento")
- Ingl√™s s√≥ permitido na aula de Ingl√™s I para termos da mat√©ria
- USA O G√âNERO CORRETO dos professores (verifica a lista acima!)
- **N√ÉO AVALIES A AULA** - s√≥ descreve o que fizeram (sem "foi √∫til", "foi interessante", "foi estimulante")
- Se o teu resumo tem menos de 200 palavras, ADICIONA mais explica√ß√µes, detalhes, exemplos
- Usa as estrat√©gias acima para expandir
- Nunca entregues um resumo com menos de 200 palavras

√öLTIMA VERIFICA√á√ÉO: L√™ o teu resumo e elimina TODAS as palavras de avalia√ß√£o (√∫til, interessante, estimulante, importante, bom, etc.) e TODAS as palavras brasileiras (experimento‚Üíexperi√™ncia, trem‚Üícomboio, etc.)

FORMATO DE RESPOSTA (JSON):
{
  "disciplinas": [
    {
      "nome": "Nome exato da disciplina",
      "resumo": "Hoje na aula de [disciplina] fizemos isto e aquilo. Primeira frase de contexto.\\n\\nSegundo par√°grafo com mais detalhes e explica√ß√µes integradas.\\n\\nTerceiro par√°grafo continuando naturalmente."
    }
  ]
}

EXEMPLO CONCRETO DE JSON V√ÅLIDO:
{
  "disciplinas": [
    {
      "nome": "Matem√°tica A",
      "resumo": "Hoje na aula de Matem√°tica A trabalh√°mos equa√ß√µes do segundo grau. Come√ß√°mos por relembrar a estrutura ax¬≤ + bx + c = 0 e depois aplic√°mos a f√≥rmula resolvente.\\n\\nFizemos v√°rios exerc√≠cios pr√°ticos onde tivemos de calcular as ra√≠zes. A f√≥rmula usa o discriminante para determinar quantas solu√ß√µes existem.\\n\\nNo final da aula resolvemos problemas mais complexos que combinavam diferentes conceitos."
    }
  ]
}

IMPORTANTE SOBRE O JSON:
- Usa \\n\\n (dois backslash-n) para separar par√°grafos
- N√ÉO uses quebras de linha reais dentro das strings JSON
- Mant√©m tudo numa √∫nica linha por string
- Certifica-te que o JSON √© v√°lido

TEXTO DAS AULAS FORNECIDO PELO ALUNO:
${prompt}

RESPONDE APENAS COM O JSON V√ÅLIDO, sem texto adicional antes ou depois.`
                    }],
                    temperature: 0.3,
                    max_tokens: 20000
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                let errorMsg = 'Erro na API do Groq';
                
                try {
                    const error = JSON.parse(errorText);
                    errorMsg = error.error?.message || errorText;
                } catch (e) {
                    errorMsg = errorText;
                }
                
                throw new Error(errorMsg);
            }

            const data = await response.json();
            
            if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                throw new Error('Resposta inv√°lida da API');
            }

            let jsonText = data.choices[0].message.content.trim();
            
            // Remover markdown se existir
            jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
            
            // Limpar caracteres de controle problem√°ticos (exceto \n e \t que s√£o v√°lidos)
            // Substitui quebras de linha literais por \n dentro de strings JSON
            jsonText = jsonText.replace(/\r\n/g, '\\n').replace(/\r/g, '\\n');
            
            let result;
            try {
                result = JSON.parse(jsonText);
            } catch (parseError) {
                // Se falhar, tenta limpar mais agressivamente
                console.error('JSON original:', jsonText);
                
                // Remove todos os caracteres de controle exceto espa√ßos
                jsonText = jsonText.replace(/[\x00-\x09\x0B-\x1F\x7F]/g, '');
                
                try {
                    result = JSON.parse(jsonText);
                } catch (secondError) {
                    throw new Error('N√£o foi poss√≠vel processar a resposta da IA. Tenta novamente.');
                }
            }
            
            // Validar estrutura b√°sica
            if (!result.disciplinas || !Array.isArray(result.disciplinas)) {
                throw new Error('Resposta JSON inv√°lida');
            }
            
            // Verificar palavras (mas n√£o dar erro, apenas retornar info)
            const avisos = [];
            result.disciplinas.forEach(disc => {
                const palavras = disc.resumo.split(/\s+/).filter(p => p.length > 0);
                if (palavras.length < 200) {
                    avisos.push({
                        disciplina: disc.nome,
                        palavras: palavras.length
                    });
                }
            });
            
            // Retornar resultado com avisos
            return { disciplinas: result.disciplinas, avisos: avisos };
        }

        function obterProfessor(disciplina) {
            const disciplinaLower = disciplina.toLowerCase();
            return DISCIPLINAS[disciplinaLower] || 'Professor n√£o identificado';
        }

        function obterBlocoESala(disciplina, diaSemana) {
            const disciplinaLower = disciplina.toLowerCase();
            
            // Normalizar nome da disciplina
            let disciplinaNormalizada = disciplina;
            
            if (disciplinaLower.includes('biologia') || disciplinaLower.includes('geologia')) {
                disciplinaNormalizada = 'Biologia e Geologia';
            } else if (disciplinaLower.includes('f√≠sica') || disciplinaLower.includes('qu√≠mica') || disciplinaLower.includes('fq')) {
                disciplinaNormalizada = 'F√≠sica e Qu√≠mica A';
            } else if (disciplinaLower.includes('matem√°tica') || disciplinaLower.includes('mat')) {
                disciplinaNormalizada = 'Matem√°tica A';
            } else if (disciplinaLower.includes('ingl√™s') || disciplinaLower.includes('ingles')) {
                disciplinaNormalizada = 'Ingl√™s I';
            } else if (disciplinaLower.includes('portugu√™s') || disciplinaLower.includes('portugues') || disciplinaLower.includes('port')) {
                disciplinaNormalizada = 'Portugu√™s';
            } else if (disciplinaLower.includes('educa√ß√£o f√≠sica') || disciplinaLower.includes('educacao fisica') || disciplinaLower.includes('edf')) {
                disciplinaNormalizada = 'Educa√ß√£o F√≠sica';
            } else if (disciplinaLower.includes('filosofia')) {
                disciplinaNormalizada = 'Filosofia';
            }

            // Obter do hor√°rio
            if (HORARIO[diaSemana] && HORARIO[diaSemana][disciplinaNormalizada]) {
                let { sala } = HORARIO[diaSemana][disciplinaNormalizada];
                
                // Remover "A." do in√≠cio da sala (ex: "A.D02" ‚Üí "D02")
                if (sala && sala.startsWith('A.')) {
                    sala = sala.substring(2);
                }
                
                // Extrair bloco da primeira letra/caracteres da sala
                // Ex: "D02" ‚Üí bloco "D", "F06" ‚Üí bloco "F", "PAV-2" ‚Üí bloco "PAV"
                let bloco = '';
                if (sala) {
                    // Se come√ßa com PAV, CS ou BS (blocos especiais), usa os primeiros caracteres
                    if (sala.startsWith('PAV') || sala.startsWith('CS') || sala.startsWith('BS')) {
                        bloco = sala.match(/^[A-Z]+/)[0];
                    } else {
                        // Caso normal: primeira letra (D02 ‚Üí D, F06 ‚Üí F)
                        bloco = sala.charAt(0);
                    }
                }
                
                return { bloco, sala };
            }

            // Default se n√£o encontrar
            return { bloco: '‚Äî', sala: '‚Äî' };
        }

        async function criarDocumentoWord(resumos, data, diaSemana) {
            const { Document, Paragraph, Table, TableCell, TableRow, WidthType, BorderStyle, Packer } = docx;

            const sections = [];

            resumos.forEach((disciplina, index) => {
                const professor = obterProfessor(disciplina.nome);
                const { bloco, sala } = obterBlocoESala(disciplina.nome, diaSemana);
                const dataFormatada = formatarData(data);

                // Criar tabela
                const table = new Table({
                    width: {
                        size: 100,
                        type: WidthType.PERCENTAGE
                    },
                    borders: {
                        top: { style: BorderStyle.SINGLE, size: 1 },
                        bottom: { style: BorderStyle.SINGLE, size: 1 },
                        left: { style: BorderStyle.SINGLE, size: 1 },
                        right: { style: BorderStyle.SINGLE, size: 1 },
                        insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },
                        insideVertical: { style: BorderStyle.SINGLE, size: 1 }
                    },
                    rows: [
                        new TableRow({
                            children: [
                                new TableCell({
                                    children: [new Paragraph({ text: 'Disciplina:', bold: true })],
                                    width: { size: 35, type: WidthType.PERCENTAGE }
                                }),
                                new TableCell({
                                    children: [new Paragraph(disciplina.nome)],
                                    width: { size: 65, type: WidthType.PERCENTAGE }
                                })
                            ]
                        }),
                        new TableRow({
                            children: [
                                new TableCell({
                                    children: [new Paragraph({ text: 'Data:', bold: true })]
                                }),
                                new TableCell({
                                    children: [new Paragraph(dataFormatada)]
                                })
                            ]
                        }),
                        new TableRow({
                            children: [
                                new TableCell({
                                    children: [new Paragraph({ text: 'Nome do professor:', bold: true })]
                                }),
                                new TableCell({
                                    children: [new Paragraph(professor)]
                                })
                            ]
                        }),
                        new TableRow({
                            children: [
                                new TableCell({
                                    children: [new Paragraph({ text: 'Bloco:', bold: true })]
                                }),
                                new TableCell({
                                    children: [new Paragraph(bloco)]
                                })
                            ]
                        }),
                        new TableRow({
                            children: [
                                new TableCell({
                                    children: [new Paragraph({ text: 'Sala:', bold: true })]
                                }),
                                new TableCell({
                                    children: [new Paragraph(sala)]
                                })
                            ]
                        })
                    ]
                });

                sections.push(table);
                sections.push(new Paragraph({ text: '' })); // Espa√ßo ap√≥s tabela

                // Adicionar resumo em par√°grafos
                const paragrafos = disciplina.resumo.split('\n\n').filter(p => p.trim());
                paragrafos.forEach((paragrafo, idx) => {
                    sections.push(new Paragraph({
                        text: paragrafo.trim(),
                        spacing: { 
                            after: idx < paragrafos.length - 1 ? 200 : 100 // Mais espa√ßo entre par√°grafos
                        }
                    }));
                });

                // Espa√ßo entre disciplinas
                if (index < resumos.length - 1) {
                    sections.push(new Paragraph({ text: '' }));
                    sections.push(new Paragraph({ text: '' }));
                }
            });

            const doc = new Document({
                sections: [{
                    properties: {},
                    children: sections
                }],
                styles: {
                    default: {
                        document: {
                            run: {
                                font: 'Segoe UI',
                                size: 24 // 12pt = 24 half-points
                            }
                        }
                    }
                }
            });

            generatedDocument = await Packer.toBlob(doc);
        }

        function formatarData(dataISO) {
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function formatarNomeFicheiro(dataISO) {
            const meses = [
                'janeiro', 'fevereiro', 'mar√ßo', 'abril', 'maio', 'junho',
                'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
            ];
            
            const [ano, mes, dia] = dataISO.split('-');
            const mesNome = meses[parseInt(mes) - 1];
            
            return `Resumo do dia ${parseInt(dia)} de ${mesNome} de ${ano}`;
        }
    </script>
</body>
</html>
